<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sản phẩm | hoangvu.vn</title>
  <link rel="stylesheet" href="css/product.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link rel="icon" href="favicon.ico" type="image/x-icon" />
  <meta name="description" content="Trang sản phẩm - hoangvu.vn" />
 
  <!-- React và Babel -->
  <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/react-router-dom@5.3.0/umd/react-router-dom.min.js"></script>
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
 
  <!-- jQuery và Bootstrap -->
  <script src="public/frontend/js/jquery-3.2.1.slim.min.js"></script>
  <script src="public/frontend/js/popper.min.js"></script>
  <script src="public/frontend/js/bootstrap.min.js"></script>
</head>
<body>
  <div id="root"></div>
 
  <!-- Header và Footer -->
  <script type="text/babel" src="js/head.js"></script>
  <script type="text/babel" src="js/footer.js"></script>
 
  <!-- Nội dung chính -->
  <script type="text/babel">
    const { useState, useEffect } = React;
    const { HashRouter, Route, Switch, Link, useParams } = ReactRouterDOM;
 
    // ✅ Hàm lấy giá trị ?search=...
    function getSearchKeyword() {
      const params = new URLSearchParams(window.location.search);
      return (params.get("search") && params.get("search").toLowerCase()) || "";
 
    }
 
    const Content = ({ products, categories }) => {
      const { slug } = useParams();
      const keyword = getSearchKeyword();
 
      // ✅ Lọc sản phẩm theo danh mục hoặc từ khóa tìm kiếm
      const filteredProducts = products.filter((p) => {
        const matchCategory = slug ? p.category === slug : true;
        const matchSearch = keyword ? p.name.toLowerCase().includes(keyword) : true;
        return matchCategory && matchSearch;
      });
 
      return (
        <div className="content">
          {/* DANH MỤC */}
          <div className="menu">
            <div className="menu-header">
              <li><i className="fas fa-bars"></i> DANH MỤC</li>
            </div>
            <ul className="menu-danhmuc">
              {categories.map((cat) => (
                <li key={cat.id}>
                  <Link to={`/category/${cat.slug}`}>
                    <i className={cat.icon}></i> {cat.name}
                  </Link>
                </li>
              ))}
            </ul>
          </div>
 
          {/* SẢN PHẨM */}
          <div className="left">
            <div className="box">
              <div className="tenMuc">
                <h2>
                  {keyword
                    ? `Kết quả tìm kiếm: "${keyword}"`
                    : slug
                    ? `Sản phẩm (${slug})`
                    : "Sản phẩm mới nhất"}
                </h2>
              </div>
              <ul>
                {filteredProducts.length > 0 ? (
                  filteredProducts.map((p) => (
                    <li key={p.id}>
                      <a href={`detail.html?id=${p.id}`}>
                        <div className="item">
                          <img src={p.image} alt={p.name} />
                          <div className="tieu_de">{p.name}</div>
                          <div className="gia">
                            <div className="tien">{p.price}</div>
                          </div>
                          <p className="details">{p.description}</p>
                        </div>
                      </a>
                    </li>
                  ))
                ) : (
                  <p>Không tìm thấy sản phẩm phù hợp.</p>
                )}
              </ul>
            </div>
          </div>
        </div>
      );
    };
 
    const App = () => {
      const [categories, setCategories] = useState([]);
      const [products, setProducts] = useState([]);
 
      useEffect(() => {
        fetch("data.json")
          .then((res) => res.json())
          .then((data) => {
            setCategories(data.categories || []);
            setProducts(data.products || []);
          })
          .catch((err) => console.error("❌ Lỗi khi tải dữ liệu:", err));
      }, []);
 
      return (
        <HashRouter>
          <Headers />
          <Switch>
            <Route exact path="/">
              <Content categories={categories} products={products} />
            </Route>
            <Route path="/category/:slug">
              <Content categories={categories} products={products} />
            </Route>
          </Switch>
          <Footer />
        </HashRouter>
      );
    };
 
    ReactDOM.render(<App />, document.getElementById("root"));
  </script>
</body>
</html>